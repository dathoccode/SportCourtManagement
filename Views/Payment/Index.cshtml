@model SportCourtManagement.Models.BookingInfoViewModel
@{
    Layout = null;
}
<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <title>Đặt lịch - Create</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="~/css/Payment/Payment.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>
    <div class="page-root">

        <!-- Header -->
        <header class="bk-header">
            <a class="bk-back" href="javascript:history.back()">&larr;</a>
            <div class="bk-title">Đặt lịch ngày trực quan</div>
            <div class="bk-spacer"></div>
        </header>

        <main class="bk-main">

            <!-- Thông tin sân -->
            <section class="card info-court">
                <div class="card-title">
                    <span class="icon">📚</span>
                    <span>Thông tin sân</span>
                </div>
                <div class="card-body">
                    <p><strong>Tên Sân: @Model.court.CourtName</strong></p>
                    <p><strong>Tên Sân: @Model.court.CourtAddress</strong></p>
                </div>
            </section>

            <!-- Thông tin lịch đặt -->
            <section class="card info-booking">
                <div class="card-title">
                    <span class="icon">🗓️</span>
                    <span>Thông tin lịch đặt</span>
                </div>
                <div class="card-body">
                    <p><strong>Ngày:</strong> @Model.booking.BookingDate</p>
                    <p><strong>Khung giờ:</strong></p>
                    <ul>
                    @foreach(var sl in Model.detail)
                    {
                            <li>@Model.slot.FirstOrDefault(s => s.SlotId == sl.SlotId)?.SlotName:@sl.StartTime - @sl.EndTime</li>
					}
                    </ul>

                    <p><strong>Đối tượng:</strong> Học sinh - sinh viên</p>
                    <p><strong>Tổng giờ: @ViewBag.TotalTime</strong></p>
                    <p class="total-line"><strong>Tổng tiền:</strong> <span class="total-amount"> @Model.booking.Price đ</span></p>
                </div>
            </section>

            

            <!-- Form nhập thông tin -->
            <form asp-action="Confirm" id="bkForm" method="post" class="bk-form">
                <label class="lbl">TÊN CỦA BẠN</label>
                <input class="input" type="text" name="CustomerName" value="@Model.account.AccName" placeholder="Nhập tên của bạn" required />
                <label class="lbl">SỐ ĐIỆN THOẠI</label>
                <div class="phone-row">
                    <button type="button" class="phone-flag">🇻🇳 <span class="code">+84</span> ▾</button>
                    <input class="input phone-input" type="tel" name="PhoneNumber" id="phone" value="@Model.account.Phone" placeholder="Nhập số điện thoại" required />
                </div>

                <label class="lbl">GHI CHÚ CHO CHỦ SÂN</label>
                <textarea name="Note" class="textarea" placeholder="Nhập ghi chú"></textarea>

                <div class="note-box">
                    <div class="note-title">⚠️ Lưu ý:</div>
                    <ul>
                        <li>Việc thanh toán được thực hiện trực tiếp giữa bạn và chủ sân.</li>
                        <li>Chúng tôi đóng vai trò kết nối, hỗ trợ bạn tìm và đặt sân dễ dàng hơn.</li>
                        <li>Mỗi sân có thể có quy định và chính sách riêng, hãy đọc kỹ để đảm bảo quyền lợi.</li>
                    </ul>
                    <p>
                        Bằng việc bấm Xác nhận và Thanh toán, bạn xác nhận đã đọc và đồng ý với
                        <a href="#">Điều khoản đặt sân</a> và
                        <a href="#">Chính sách hoàn tiền và hủy lịch</a>.
                    </p>
                </div>

                <button class="btn-confirm" id="confirmBtn">XÁC NHẬN &amp; THANH TOÁN</button>
            </form>

        </main>
    </div>

    <!-- optional small script to prevent page jumping on mobile when focusing inputs -->
    <script>
        const rawModel = {
            booking: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.booking)),
            detail: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.detail)),
        };

		//gửi dữ liệu lên server để thêm vào database
        document.getElementById('bkForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // Lấy toàn bộ ViewModel từ hidden
            let vm = rawModel;


            fetch('/Payment/Confirm', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(vm)
            })
            .then(r => r.json())
            .then(success => {
                if (success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Đặt lịch thành công!',
                    }).then(() => window.location.href = '/Home/Index');
                } else {
                    Swal.fire({ icon: 'error', title: 'Đặt lịch thất bại!' });
                }
            });
        });


    </script>
</body>
</html>
